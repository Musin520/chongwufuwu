# 测试规格说明书

## 1. 项目概述

**项目名称**: myJavaProject  
**版本**: 0.0.1-SNAPSHOT  
**技术栈**: Spring Boot 2.7.3 + MyBatis + MySQL + 阿里云OSS  
**测试框架**: JUnit 5 + Mockito + Spring Boot Test

## 2. 测试范围

### 2.1 核心功能模块
- Web控制器层 (Spring MVC)
- 业务服务层 (Service)
- 数据访问层 (MyBatis)
- 文件存储服务 (阿里云OSS)
- 二维码生成功能
- Excel文档处理
- 页面模板渲染 (Thymeleaf/FreeMarker)
- 数据分页功能 (PageHelper)

### 2.2 非功能性测试
- 性能测试
- 安全性测试
- 兼容性测试
- 可靠性测试

## 3. 测试策略

### 3.1 测试金字塔
```
    E2E Tests (10%)
   ─────────────────
  Integration Tests (20%)
 ─────────────────────────
Unit Tests (70%)
```

### 3.2 测试分层
- **单元测试**: 70% 覆盖率目标
- **集成测试**: 20% 覆盖率目标  
- **端到端测试**: 10% 覆盖率目标

## 4. 详细测试用例

### 4.1 Web控制器测试

#### 4.1.1 用户管理控制器
**测试类**: `UserControllerTest`

| 测试用例ID | 测试描述 | 输入 | 期望输出 | 优先级 |
|-----------|---------|------|---------|--------|
| TC_UC_001 | 用户注册成功 | 有效用户信息 | HTTP 200, 用户ID | 高 |
| TC_UC_002 | 用户注册失败-邮箱重复 | 重复邮箱 | HTTP 400, 错误信息 | 高 |
| TC_UC_003 | 用户登录成功 | 正确凭据 | HTTP 200, JWT Token | 高 |
| TC_UC_004 | 用户登录失败 | 错误凭据 | HTTP 401, 错误信息 | 高 |
| TC_UC_005 | 获取用户信息 | 有效Token | HTTP 200, 用户详情 | 中 |

#### 4.1.2 文件上传控制器
**测试类**: `FileUploadControllerTest`

| 测试用例ID | 测试描述 | 输入 | 期望输出 | 优先级 |
|-----------|---------|------|---------|--------|
| TC_FU_001 | 图片上传成功 | 有效图片文件 | HTTP 200, 文件URL | 高 |
| TC_FU_002 | 文件类型验证 | 非法文件类型 | HTTP 400, 错误信息 | 高 |
| TC_FU_003 | 文件大小限制 | 超大文件 | HTTP 413, 错误信息 | 中 |
| TC_FU_004 | Excel文件上传 | 有效Excel文件 | HTTP 200, 解析结果 | 高 |

### 4.2 业务服务层测试

#### 4.2.1 OSS文件服务测试
**测试类**: `OssServiceTest`

| 测试用例ID | 测试描述 | 测试方法 | Mock对象 | 断言 |
|-----------|---------|----------|---------|------|
| TC_OSS_001 | 文件上传成功 | `uploadFile()` | OSS Client | 返回文件URL |
| TC_OSS_002 | 文件删除成功 | `deleteFile()` | OSS Client | 返回true |
| TC_OSS_003 | 获取文件URL | `getFileUrl()` | OSS Client | 返回有效URL |
| TC_OSS_004 | 上传异常处理 | `uploadFile()` | 抛出异常 | 捕获并处理异常 |

#### 4.2.2 二维码服务测试
**测试类**: `QrCodeServiceTest`

| 测试用例ID | 测试描述 | 输入参数 | 期望输出 | 验证点 |
|-----------|---------|----------|---------|--------|
| TC_QR_001 | 生成二维码成功 | 文本内容 | 二维码图片 | 图片格式正确 |
| TC_QR_002 | 二维码解析 | 二维码图片 | 原始文本 | 内容一致 |
| TC_QR_003 | 自定义尺寸 | 文本+尺寸 | 指定尺寸图片 | 尺寸正确 |

#### 4.2.3 Excel处理服务测试
**测试类**: `ExcelServiceTest`

| 测试用例ID | 测试描述 | 输入 | 期望输出 | 验证点 |
|-----------|---------|------|---------|--------|
| TC_EX_001 | Excel导出 | 数据列表 | Excel文件 | 数据完整性 |
| TC_EX_002 | Excel导入 | Excel文件 | 数据对象列表 | 解析正确性 |
| TC_EX_003 | 模板生成 | 表头定义 | Excel模板 | 格式正确 |

### 4.3 数据访问层测试

#### 4.3.1 用户数据访问测试
**测试类**: `UserMapperTest`

| 测试用例ID | 测试描述 | SQL操作 | 测试数据 | 验证点 |
|-----------|---------|---------|----------|--------|
| TC_UM_001 | 插入用户 | INSERT | 用户对象 | 返回生成ID |
| TC_UM_002 | 查询用户 | SELECT | 用户ID | 返回用户信息 |
| TC_UM_003 | 更新用户 | UPDATE | 用户对象 | 影响行数=1 |
| TC_UM_004 | 删除用户 | DELETE | 用户ID | 影响行数=1 |
| TC_UM_005 | 分页查询 | SELECT | 分页参数 | 返回分页结果 |

### 4.4 集成测试

#### 4.4.1 数据库集成测试
**测试类**: `DatabaseIntegrationTest`

| 测试用例ID | 测试描述 | 测试场景 | 验证点 |
|-----------|---------|----------|--------|
| TC_DB_001 | 事务回滚测试 | 异常情况下事务回滚 | 数据一致性 |
| TC_DB_002 | 连接池测试 | 并发数据库访问 | 连接正常 |
| TC_DB_003 | 数据迁移测试 | Flyway脚本执行 | 表结构正确 |

#### 4.4.2 OSS集成测试
**测试类**: `OssIntegrationTest`

| 测试用例ID | 测试描述 | 测试环境 | 验证点 |
|-----------|---------|----------|--------|
| TC_OSS_INT_001 | 真实OSS上传 | 测试环境OSS | 文件可访问 |
| TC_OSS_INT_002 | 批量文件操作 | 多文件上传删除 | 操作成功 |

### 4.5 端到端测试

#### 4.5.1 用户流程测试
**测试类**: `UserJourneyE2ETest`

| 测试用例ID | 测试描述 | 测试步骤 | 验证点 |
|-----------|---------|----------|--------|
| TC_E2E_001 | 完整用户注册流程 | 注册→验证→登录 | 流程顺畅 |
| TC_E2E_002 | 文件上传下载流程 | 上传→存储→下载 | 文件完整 |

## 5. 性能测试规格

### 5.1 负载测试
| 测试场景 | 并发用户数 | 持续时间 | 响应时间要求 | 成功率要求 |
|---------|-----------|----------|-------------|-----------|
| 用户登录 | 100 | 5分钟 | <500ms | >99% |
| 文件上传 | 50 | 10分钟 | <2s | >95% |
| 数据查询 | 200 | 5分钟 | <200ms | >99% |

### 5.2 压力测试
| 测试场景 | 最大并发数 | 系统资源限制 | 预期结果 |
|---------|-----------|-------------|----------|
| 系统极限 | 500 | CPU<80%, 内存<85% | 优雅降级 |

## 6. 安全测试规格

### 6.1 认证授权测试
| 测试用例ID | 测试描述 | 攻击方式 | 预期防护 |
|-----------|---------|----------|----------|
| TC_SEC_001 | SQL注入防护 | 恶意SQL | 参数化查询阻止 |
| TC_SEC_002 | XSS防护 | 脚本注入 | 输入过滤 |
| TC_SEC_003 | CSRF防护 | 跨站请求 | Token验证 |
| TC_SEC_004 | 文件上传安全 | 恶意文件 | 类型检查 |

## 7. 测试环境配置

### 7.1 测试数据库
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/test_db
    username: test_user
    password: test_password
  jpa:
    hibernate:
      ddl-auto: create-drop
```

### 7.2 Mock服务配置
```yaml
oss:
  endpoint: http://localhost:9000  # MinIO测试服务
  accessKeyId: testkey
  accessKeySecret: testsecret
  bucketName: test-bucket
```

## 8. 测试执行计划

### 8.1 测试阶段
| 阶段 | 测试类型 | 执行时机 | 负责人 |
|------|---------|----------|--------|
| 开发阶段 | 单元测试 | 代码提交前 | 开发人员 |
| 集成阶段 | 集成测试 | 每日构建 | 测试人员 |
| 发布前 | 全量测试 | 发布前一周 | 测试团队 |

### 8.2 自动化执行
```bash
# 单元测试
mvn test

# 集成测试
mvn verify -P integration-test

# 性能测试
mvn gatling:test

# 代码覆盖率
mvn jacoco:report
```

## 9. 测试报告要求

### 9.1 覆盖率要求
- 代码行覆盖率: ≥80%
- 分支覆盖率: ≥70%
- 方法覆盖率: ≥85%

### 9.2 缺陷分级
| 级别 | 描述 | 响应时间 |
|------|------|----------|
| P0 | 系统崩溃 | 2小时 |
| P1 | 核心功能异常 | 1天 |
| P2 | 一般功能问题 | 3天 |
| P3 | 优化建议 | 1周 |

## 10. 测试工具和框架

### 10.1 测试框架
- **JUnit 5**: 单元测试框架
- **Mockito**: Mock框架
- **TestContainers**: 集成测试容器
- **Spring Boot Test**: Spring测试支持
- **WireMock**: HTTP服务Mock

### 10.2 性能测试工具
- **JMeter**: 负载测试
- **Gatling**: 性能测试
- **JProfiler**: 性能分析

### 10.3 代码质量工具
- **JaCoCo**: 代码覆盖率
- **SonarQube**: 代码质量分析
- **SpotBugs**: 静态代码分析